(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define("uas",factory)}else if(typeof exports==="object"){exports=module.exports=factory()}else{root.uas=factory()}})(this,function(){"use strict";try{if(window&&window.uas&&window.uas.testuas()){return window.uas}}catch(e){}var iswx=false;try{if(wx.request)iswx=true;if(wx.uas&&wx.uas.testuas()){return wx.uas}}catch(e){}function wxreq_(url,method,data,callback){var param={};param.url=url;param.method=method;param.dataType="json";param.data=data;if(method==="POST"){param.header={"content-type":"application/json"}}param.success=function(res){callback(res.data)};param.fail=function(res){callback({code:-1,data:res})};wx.request(param)}function wxreq(){var url=null;var method="GET";var postData=null;return{get:function(u){url=u;return this},post:function(u,data){url=u;method="POST";postData=data;return this},then:function(callback){wxreq_(url,method,postData,callback)}}}var fake=function(_){return false};function ajax(options){var methods=["get","post","put","delete"];options=options||{};options.baseUrl=options.baseUrl||"";if(options.method&&options.url){return xhrConnection(options.method,options.baseUrl+options.url,maybeData(options.data),options)}return methods.reduce(function(acc,method){acc[method]=function(url,data){return xhrConnection(method,options.baseUrl+url,maybeData(data),options)};return acc},{})}function maybeData(data){return data||null}function xhrConnection(type,url,data,options){var returnMethods=["then","catch","always"];var promiseMethods=returnMethods.reduce(function(promise,method){promise[method]=function(callback){promise[method]=callback;return promise};return promise},{});var xhr=new XMLHttpRequest;var featuredUrl=getUrlWithData(url,data,type);xhr.open(type,featuredUrl,true);xhr.withCredentials=options.hasOwnProperty("withCredentials");setHeaders(xhr,options.headers,data);xhr.addEventListener("readystatechange",ready(promiseMethods,xhr),false);xhr.send(isObject(data)?JSON.stringify(data):data);promiseMethods.abort=function(){return xhr.abort()};return promiseMethods}function getUrlWithData(url,data,type){if(type.toLowerCase()!=="get"||!data){return url}var dataAsQueryString=objectToQueryString(data);var queryStringSeparator=url.indexOf("?")>-1?"&":"?";return url+queryStringSeparator+dataAsQueryString}function setHeaders(xhr,headers,data){headers=headers||{};if(!hasContentType(headers)){headers["Content-Type"]=isObject(data)?"application/json":"application/x-www-form-urlencoded"}Object.keys(headers).forEach(function(name){headers[name]&&xhr.setRequestHeader(name,headers[name])})}function hasContentType(headers){return Object.keys(headers).some(function(name){return name.toLowerCase()==="content-type"})}function ready(promiseMethods,xhr){return function handleReady(){if(xhr.readyState===xhr.DONE){xhr.removeEventListener("readystatechange",handleReady,false);promiseMethods.always.apply(promiseMethods,parseResponse(xhr));if(xhr.status>=200&&xhr.status<300){promiseMethods.then.apply(promiseMethods,parseResponse(xhr))}else{promiseMethods.catch.apply(promiseMethods,parseResponse(xhr))}}}}function parseResponse(xhr){var result;try{result=JSON.parse(xhr.responseText)}catch(e){result=xhr.responseText}return[result,xhr]}function objectToQueryString(data){return isObject(data)?getQueryString(data):data}function isObject(data){return Object.prototype.toString.call(data)==="[object Object]"}function getQueryString(obj,prefix){return Object.keys(obj).map(function(key){if(obj.hasOwnProperty(key)&&undefined!==obj[key]){var val=obj[key];key=prefix?prefix+"["+key+"]":key;return val!==null&&typeof val==="object"?getQueryString(val,key):encode(key)+"="+encode(val)}}).filter(Boolean).join("&")}function encode(value){return encodeURIComponent(value)}function jsonp_(url,callback){var script=document.createElement("script");var cb="uas_cb_"+guid();if(url.indexOf("?")>-1){url+="&jsonp="+cb}else{url+="?jsonp="+cb}var timer=setInterval(function(){clearInterval(timer);callback({msg:"checklogin:timeout",code:-3})},6e3);window[cb]=function(data){clearInterval(timer);callback(data);try{window[cb]=null;script.parentNode.removeChild(script)}catch(e){}};script.src=url;document.body.insertBefore(script,document.body.firstChild)}function jsonp(){var url=null;return{get:function(u){url=u;return this},then:function(callback){jsonp_(url,callback)}}}var hexarra="0123456789abcdef";function writeShort(v){var b=[];b.push(v>>>8&255);b.push(v>>>0&255);return b}function len(i){if(i<15){return hexarra.charAt(i)}var b=writeShort(i);var hex=[];hex.push("e");hex.push(hexarra.charAt(b[0]>>>4));hex.push(hexarra.charAt(b[0]&15));hex.push(hexarra.charAt(b[1]>>>4));hex.push(hexarra.charAt(b[1]&15));return hex.join("")}function token(ar){var th=[];var tb=[];th.push(hexarra.charAt(ar.length));for(var i=0;i<ar.length;i++){th.push(len(ar[i].length));tb.push(ar[i])}th.push(tb.join(""));return th.join("")}function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}function guid(){var id=[];for(var i=0;i<8;i++){id.push(S4())}return id.join("")}function Sha256(){function rotateRight(n,x){return x>>>n|x<<32-n}function choice(x,y,z){return x&y^~x&z}function majority(x,y,z){return x&y^x&z^y&z}function sha256_Sigma0(x){return rotateRight(2,x)^rotateRight(13,x)^rotateRight(22,x)}function sha256_Sigma1(x){return rotateRight(6,x)^rotateRight(11,x)^rotateRight(25,x)}function sha256_sigma0(x){return rotateRight(7,x)^rotateRight(18,x)^x>>>3}function sha256_sigma1(x){return rotateRight(17,x)^rotateRight(19,x)^x>>>10}function sha256_expand(W,j){return W[j&15]+=sha256_sigma1(W[j+14&15])+W[j+9&15]+sha256_sigma0(W[j+1&15])}var K256=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298);var ihash,count,buffer;var sha256_hex_digits="0123456789abcdef";function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function sha256_init(){ihash=new Array(8);count=new Array(2);buffer=new Array(64);count[0]=count[1]=0;ihash[0]=1779033703;ihash[1]=3144134277;ihash[2]=1013904242;ihash[3]=2773480762;ihash[4]=1359893119;ihash[5]=2600822924;ihash[6]=528734635;ihash[7]=1541459225}function sha256_transform(){var a,b,c,d,e,f,g,h,T1,T2;var W=new Array(16);a=ihash[0];b=ihash[1];c=ihash[2];d=ihash[3];e=ihash[4];f=ihash[5];g=ihash[6];h=ihash[7];for(var i=0;i<16;i++)W[i]=buffer[(i<<2)+3]|buffer[(i<<2)+2]<<8|buffer[(i<<2)+1]<<16|buffer[i<<2]<<24;for(var j=0;j<64;j++){T1=h+sha256_Sigma1(e)+choice(e,f,g)+K256[j];if(j<16)T1+=W[j];else T1+=sha256_expand(W,j);T2=sha256_Sigma0(a)+majority(a,b,c);h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}ihash[0]+=a;ihash[1]+=b;ihash[2]+=c;ihash[3]+=d;ihash[4]+=e;ihash[5]+=f;ihash[6]+=g;ihash[7]+=h}function sha256_update(data,inputLen){var i,index,curpos=0;index=count[0]>>3&63;var remainder=inputLen&63;if((count[0]+=inputLen<<3)<inputLen<<3)count[1]++;count[1]+=inputLen>>29;for(i=0;i+63<inputLen;i+=64){for(var j=index;j<64;j++)buffer[j]=data.charCodeAt(curpos++);sha256_transform();index=0}for(var j=0;j<remainder;j++)buffer[j]=data.charCodeAt(curpos++)}function sha256_final(){var index=count[0]>>3&63;buffer[index++]=128;if(index<=56){for(var i=index;i<56;i++)buffer[i]=0}else{for(var i=index;i<64;i++)buffer[i]=0;sha256_transform();for(var i=0;i<56;i++)buffer[i]=0}buffer[56]=count[1]>>>24&255;buffer[57]=count[1]>>>16&255;buffer[58]=count[1]>>>8&255;buffer[59]=count[1]&255;buffer[60]=count[0]>>>24&255;buffer[61]=count[0]>>>16&255;buffer[62]=count[0]>>>8&255;buffer[63]=count[0]&255;sha256_transform()}function sha256_encode_bytes(){var j=0;var output=new Array(32);for(var i=0;i<8;i++){output[j++]=ihash[i]>>>24&255;output[j++]=ihash[i]>>>16&255;output[j++]=ihash[i]>>>8&255;output[j++]=ihash[i]&255}return output}function sha256_encode_hex(){var output=new String;for(var i=0;i<8;i++){for(var j=28;j>=0;j-=4)output+=sha256_hex_digits.charAt(ihash[i]>>>j&15)}return output}return{digest:function(data){sha256_init();sha256_update(data,data.length);sha256_final();return sha256_encode_hex()}}}var $1=Sha256;var $d=function(_){return _};function http(){return iswx?wxreq():jsonp()}function ypromise(){this.msg=null;this.value=null;this.func=null;this.ch=null;this.finish=false;this.fired=false;this.fire=function(val){this.finish=true;if(this.func!=null&&typeof this.func==="function"){this.value=val;this.func(val)}else{this.value=val}};this.error=function(err){this.finish=true;if(this.ch!=null&&typeof this.ch==="function"){this.msg=err;this.ch(err)}else{this.msg=err}};this.then=function(f){this.func=f;this.tryFire()};this.Catch=function(f){this.ch=f;this.tryFire()};this.tryFire=function(){if(this.fired)return;if(this.finish){this.fired=true;if(this.msg!=null){this.error(this.msg)}else{this.fire(this.value)}}}}var hash=null;var user=null;var uasServer="/uas/server";function login(account,passpwd,code,url){code=doCaptcha(code);account=s10(account);passpwd=s10(passpwd);var domain=guid();if(uasDomain!=null){domain=domain+"."+uasDomain}var data=token([account,guid(),passpwd,domain,code,"uc"]);var func=null;var d=null;if(url){window.location.href=uasServer+"?e=login&PE=S1&guid="+gcccode+"&data="+data+"&vcc="+vcc(data)+"&url="+removeParamter(url,"uas_st");return null}var vc=vcc(data);http().get(uasServer+"?e=user&PE=S1&uas_login="+data+"&guid="+gcccode+"&vcc="+vc).then(function(u){fake=fake||function(){return false};if(u&&u.id!=null&&!fake(u,$d)){user=u;user=s7(vc)(user);hash=u.hash;u.hash=null;if(u.time){duration=(new Date).getTime()-u.time}}else{var msg=u.msg||"账号或密码错误";if(msg==="invailed token"){msg="账号或密码错误"}u=null;u={code:"-1",msg:msg}}d=u;if(func&&typeof func==="function"){func(u)}});return{then:function(f){if(d!=null){f(d)}else{func=f}}}}function getServiceTicket(account,passpwd,code){code=doCaptcha(code);account=s10(account);passpwd=s10(passpwd);var domain=guid();if(uasDomain!=null){domain=domain+"."+uasDomain}var data=token([account,guid(),passpwd,domain,code,"uc"]);return http().get(uasServer+"?e=get-st&uas_login="+data+"&guid="+gcccode+"&PE=S1&vcc="+vcc(data))}function tfa(token,code,type){if(!type){type="info"}var vc=vcc(token);var p=new ypromise;http().get(uasServer+"?e=2fa-login&PE=S1&data="+token+"&guid="+gcccode+"&vcc="+vc+"&code="+code+"&token="+token+"&type="+type).then(function(u){p.fire(u)});return p}function server(url){uasServer=url+"/uas/server";init()}function getUser(){return deepClone(user)}var roles=null;function loadRoles(u){http().get(uasServer+"?e=roles&user_id="+u.id+"&guid="+gcccode+"&vcc="+vcc(u.id)).then(function(d){u.roles=d})}function sleep(delay){var start=(new Date).getTime();while((new Date).getTime()-start<delay){continue}}function wait(func,interval,fin){var cor={f:func,fi:fin,i:interval,max:30,count:0};var a=function(cor){if(!cor.f()){cor.count++;if(cor.count<cor.max){setTimeout(function(){a(cor)},cor.i)}else{if(cor.fi&&typeof cor.fi==="function"){cor.fi()}}}};a(cor)}function logout(){jsonp().get(uasServer+"?e=logout").then(function(a){});user=null}function changePassword(account,opwd,npwd,func){account=b64.encode(account);opwd=b64.encode(opwd);npwd=b64.encode(npwd);var data=token([account,guid(),opwd,guid(),npwd,".."]);http().get(uasServer+"?e=changePwd&data="+data).then(function(a){if(func&&typeof func==="function"){func(a)}});user=null;hash=null}var lastCheck=(new Date).getTime();function check(){if((new Date).getTime()-lastCheck>6e5){lastCheck=(new Date).getTime();return false}else{return true}}function getParamter(url,name){var off=url.indexOf("?")+1;if(off<=0)return null;var b=url.substr(off,url.length-off);var kvs=b.split("&");var p=null;for(var i=0;i<kvs.length;i++){var kv=kvs[i];if(kv.indexOf("=")<1)continue;var ar=kv.split("=");if(ar.length<2)continue;if(ar[0]===name)p=ar[1]}if(p==null)return null;if(p.indexOf("/")>-1){p=p.substring(0,p.indexOf("/"))}if(p.indexOf("#")>-1){p=p.substring(0,p.indexOf("#"))}return p}function removeParamter(url,p){if(url.indexOf("?")<0){return url}var off=url.indexOf("?")+1;var urls=[];var prefix=url.substr(0,off-1);var b=url.substr(off,url.length-off);var kvs=b.split("&");for(var i=0;i<kvs.length;i++){var kv=kvs[i];if(kv.indexOf("=")<1)continue;var ar=kv.split("=");if(ar.length<2)continue;if(ar[0]===p){}else{urls.push(kv)}}if(urls.length>0){return prefix+"?"+urls.join("&")}else{return prefix}}var getThirdToken=null;function getst(win){if(!win)return null;if(getThirdToken!=null){var tk=getThirdToken(win);if(tk)return tk}return getParamter(win.location.href,"uas_st")}var support_kick=true;function checkKick(){if(!support_kick)return;if(user==null||user.id==null)return;var query="?e=kick&id="+user.id;if(uasDomain){query+="&domain="+uasDomain}http().get(uasServer+query).then(function(rst){if(rst.code===-3){support_kick=false}else if(rst.code!=0){user=null;alert("你的账号已经在别处登陆！");window.location.href=uasServer+"?e=logout&url="+window.location.href}})}function checkLogin(func,win){checkKick();if(user&&user.id&&check()){func(deepClone(user));return}var w=win||window;var st=getst(w);if(st){checkst(func,st)}else{checkdefalut(func)}}function checkdefalut(func){var data=S4();var vc=vcc(data);http().get(uasServer+"?e=user&uas_online=checklogin&PE=S1&guid="+gcccode+"&vcc="+vc+"&data="+data).then(function(u){if(u&&u.id!=null){user=u;user=s7(vc)(u);hash=u.hash;u.hash=null;uasDomain=u.domain;if(u.time){duration=(new Date).getTime()-u.time}if(!u.roles){loadRoles(u)}if(func&&typeof func==="function"){wait(function(){if(user.roles){func(deepClone(user));return true}return false},50,function(){func(deepClone(user))})}}else{if(func&&typeof func==="function"){func(u)}}})}function isArray(b){return b.push&&b.join&&typeof b.push==="function"&&typeof b.join==="function"}function checkst(func,st){var vc=vcc(st);http().get(uasServer+"?e=user&PE=S1&uas_st="+st+"&guid="+gcccode+"&vcc="+vc).then(function(u){if(u&&u.id!=null){user=u;user=s7(vc)(u);hash=u.hash;u.hash=null;uasDomain=u.domain;if(u.time){duration=(new Date).getTime()-u.time}if(!u.roles){loadRoles(u)}if(func&&typeof func==="function"){wait(function(){if(user.roles){func(deepClone(user));return true}return false},50,function(){func(deepClone(user))})}}else{if(func&&typeof func==="function"){func(u)}}})}var uasDomain=null;var duration=null;function getToken(){if(user==null)return null;var oid=user.id;var uid=guid();var e="0";if(duration){var exp=((new Date).getTime()-duration+1e4)/100;e=""+Math.round(exp)}else{var exp=((new Date).getTime()+1e4)/100;e=""+Math.round(exp)}var param=[oid,uid,e];if(uasDomain!=null)param.push(uasDomain);var step1=Sha256().digest(param.join(""));var step2=Sha256().digest(step1+hash);var tkp=null;if(uasDomain!=null){tkp=[oid,uid,e,step2,"0",uasDomain]}else{tkp=[oid,uid,e,step2]}return token(tkp)}var b64=function(){var base64={};base64.map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*.=";base64.decode=function(s){s+="";var len=s.length;var padchar=base64.map.charAt(64);if(len===0){return s}if(len%4!==0){if(len%4==3){s+=padchar}else if(len%4==2){s+=padchar+padchar}else{return""}}len=s.length;var pads=0;if(s.charAt(len-1)===padchar){pads++;if(s.charAt(len-2)===padchar){pads++}len-=4}var i,b,map=base64.map,x=[];for(i=0;i<len;i+=4){b=map.indexOf(s.charAt(i))<<18|map.indexOf(s.charAt(i+1))<<12|map.indexOf(s.charAt(i+2))<<6|map.indexOf(s.charAt(i+3));x.push(String.fromCharCode(b>>16,b>>8&255,b&255))}switch(pads){case 1:b=map.indexOf(s.charAt(i))<<18|map.indexOf(s.charAt(i+1))<<12|map.indexOf(s.charAt(i+2))<<6;x.push(String.fromCharCode(b>>16,b>>8&255));break;case 2:b=map.indexOf(s.charAt(i))<<18|map.indexOf(s.charAt(i+1))<<12;x.push(String.fromCharCode(b>>16));break}return unescape(x.join(""))};base64.encode=function(s){if(!s){return}s+="";if(s.length===0){return s}s=escape(s);var i,b,x=[],map=base64.map;var len=s.length-s.length%3;var padchar=map.charAt(64);for(i=0;i<len;i+=3){b=s.charCodeAt(i)<<16|s.charCodeAt(i+1)<<8|s.charCodeAt(i+2);x.push(map.charAt(b>>18));x.push(map.charAt(b>>12&63));x.push(map.charAt(b>>6&63));x.push(map.charAt(b&63))}switch(s.length-len){case 1:b=s.charCodeAt(i)<<16;x.push(map.charAt(b>>18)+map.charAt(b>>12&63));break;case 2:b=s.charCodeAt(i)<<16|s.charCodeAt(i+1)<<8;x.push(map.charAt(b>>18)+map.charAt(b>>12&63)+map.charAt(b>>6&63));break}return x.join("")};return base64}();$d=function(_){return $1().digest(_)};function Code(){var nums_en="23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz";var nums_cn="的一是了不在有人上这大我国来们和个他中说"+"到地为以子小就时全可下要十生会也出年得你"+"主用那道学工多去发作自好过动对行里能二天"+"三同成活太事面民日家方后都于之分经种还看"+"产所起把进前着没而样部长又问法从本定见两"+"新现如么力等电开五心只实社水外政很高月业"+"当义些加老著四头因向理点合明无机意使第正"+"度物想体此知关制然其表重化应各但者间百比"+"什儿公做九相气命西话将内与由利今手平量员"+"回情几最八级位结性代教次路党六便原军总走"+"象口七先常题入给己队战果完反白建革立少文"+"打论门东女放期真数展资通农名解叫提或山线"+"条别万系已变形它边阶报官决她及争声北求世"+"耍美再听才运必安取被南接华干区身济共计特"+"改吃书马组界议车并海育思设件光强品直许造"+"务流治领联金记任受极基质指帮目市快千导花"+"科难深保住统管处认志图则研劳每场带亲至根"+"更斗收信究且怎近非料何呢热术夫眼交布石达"+"步拉众省风据奸增程火团字却油米委色式切望"+"器办群观算调母土较请元爱持清广张连压觉识"+"林际举即死专局类空单权毛师商孩装批府找往"+"王校该未席约照易神克号京转须半习青早规验"+"拿服节精树传备钱技讲告德参斯具织集病友谈"+"示积亚复厂越支婚历兵胜选整铁势笑院板球河"+"吗除准况影倒若格断甚速言采哪离县写台古远"+"士感般呀低确晚害细标兴房游消够坐足史飞注"+"紧食列失候周破推温英喜片苏首价双赛证木角"+"族苦引始哥跟念故助容需落草项功送巴船罢鱼"+"虽音试包洋怕似养满防红修田妇银城职止希查"+"江站村曾黑段随费黄父续乐块买衣型状视愿投"+"司欢效响刻存尽跑坚差滑武纪围阿层划企客底"+"屋阳律妈派啊护施富像留让敌吧供皮维值既例"+"急弟答严轮孔击款息扬叶轻朝率责营雨监忙称"+"继固渐医良初刀星按坏帝负待姑夜属密简排均"+"显旧啦谁尺云副男致适协靠艺脚换配宽迫洲久"+"财免旅错姐归令余读创置益穿端抗独某判闻敢"+"午冷材春守虫仅态圆岁预宣略源素矿充刚语左"+"考仍恩烟构乡酒付画座君逐卖卫跳绝朋降李占"+"汽药货救另获微伤奇减策句赶承州终娘案诉右"+"依短察芬优杂波居爷限呼停互章纸封央脸普瓶"+"演室背饭借顶肯乱班诸床乎善环您困吸假齐福"+"慢血激毫担桥讨凭印钟鲜掉零童怪戏述汉尼含"+"散杀恶斤肉肆牛模液罪评检范睛亦茶香访射烧"+"灯兰沙针罗旁替脑输烈练境努径升钢哭突恐贵"+"植粉酸削丝误野礼巷冲测麦露否登危搞歌亮欧"+"痛唱玩肥超菜攻鼓退藏谢哈暗缺户迎堂训陈敬"+"馆险妹移弹景顾课惊播挥熟票夺培棉夏灭抓味"+"松掌架静曲粮束赞犯忽编异翻促套脱鼠祖尚尤"+"嘴础伟骨潮载威阵闹园磨玉鸡侵竟概抵季执冬"+"核补孙遇兄辨弄讯丰顺宝庄永毒托睡枝洞录港"+"婆唤垂愁喷炼糊涂叹丁壳泰鸣予倾贺舍虑秀朗";var nums=nums_en;var canvas=null;var code=null;function randomCode(str,len){var rand=new Array;for(var i=0;i<len;i++){var r=Math.floor(Math.random()*nums.length);rand.push(nums.charAt(r))}return rand.join("")}function draw(str){var canvas=document.createElement("canvas");canvas.width=80;canvas.height=30;var context=canvas.getContext("2d");context.fillStyle="cornflowerblue";context.fillRect(0,0,canvas.width,canvas.height);context.fillStyle="white";context.font="15px Arial";for(var i=0;i<str.length;i++){var c=str.charAt(i);var x=i*15+8;var y=Math.random()*15+15;context.fillText(c,x,y)}for(var i=0;i<3;i++){drawline(canvas,context)}for(var i=0;i<10;i++){drawDot(canvas,context)}return convertCanvasToImage(canvas)}function drawline(canvas,context){context.moveTo(Math.floor(Math.random()*canvas.width),Math.floor(Math.random()*canvas.height));context.lineTo(Math.floor(Math.random()*canvas.width),Math.floor(Math.random()*canvas.height));context.lineWidth=.5;Math.random()*2+.5;context.strokeStyle="rgba(255,255,255,0.3)";context.stroke()}function drawDot(canvas,context){var px=Math.floor(Math.random()*canvas.width);var py=Math.floor(Math.random()*canvas.height);context.moveTo(px,py);context.lineTo(px+1,py+1);context.lineWidth=.8;context.stroke()}function trans(canvas,ctx){var height=canvas.height;var width=canvas.width;for(var i=height;i>0;i--){ctx.putImageData(ctx.getImageData(0,width-i+Math.sin(i/10)*i/10,width,1),Math.sin(i/10)*i/10,width+i-1)}}function convertCanvasToImage(canvas){return canvas.toDataURL("image/png")}function getImage(){code=randomCode(nums,4);return draw(code)}function test(ac){var a=ac?ac.toUpperCase():"";var b=code.toUpperCase();return a===b}function useChinese(){nums=nums_cn}return{getImage:getImage,test:test,useChinese:useChinese}}var code=Code();var captcha=false;var capHash="dovdok09dcxjJNDSDFkjhsfsfqwF32dsf";function capToken(){var uid=guid();var h=Sha256().digest(uid+capHash);return token([uid,S4(),h])}var $h=function(d){return Sha256().digest(d)};function doCaptcha(ccode){if(!captcha)return"0000";if(imageCount<1)return"0001";if(code.test(ccode)){return capToken()}else{return"0002"}}function useCaptcha(){captcha=true;http().get(uasServer+"?e=version").then(function(a){capHash=a.hash})}function sendsms(phone){return http().get(uasServer+"?e=sendsms&phone="+phone+"&guid="+gcccode+"&vcc="+vcc(phone))}function useChinese(){code.useChinese()}var imageCount=0;function getImage(){imageCount++;return code.getImage()}function test(ccode){if(code.test(ccode)){return true}return false}function version(){return"1.1.9"}function testuas(){return true}function jumpsso(win){var url=win.location.href;win.location.href=uasServer+"?e=sso&url="+removeParamter(url,"uas_st")}function domain(d){uasDomain=d}function s1(){try{var canvas=document.createElement("canvas");if(!canvas.getContext)return"g:not-modern";var gl=canvas.getContext("experimental-webgl");if(!gl)return"g:classic";var debugInfo=gl.getExtension("WEBGL_debug_renderer_info");if(!debugInfo)return"g:classic1";return gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)}catch(e){return"g:classic3"+e}}function s5(h){var a=["userAgent","hardwareConcurrency","connection.effectiveType","languages","appVersion","buildID","platform"];var rest=[];for(var i=0;i<a.length;i++){rest.push(s3(window,"navigator."+a[i]))}rest.push(s1());rest.push(s2());return h(rest.join("|"))}function s3(nav,key,def){try{var ks=key.split(".");var v=nav;for(var i in ks){if(!v)break;var v=v[ks[i]]}return v?v:def?def:"----"}catch(e){return def?def:"----"}}function s2(){try{return window.navigator.plugins.length}catch(e){return"np"}}var gcccode=s5($h);function ip2int(ip){var num=0;ip=ip.split(".");num=Number(ip[0])*256*256*256+Number(ip[1])*256*256+Number(ip[2])*256+Number(ip[3]);num=num>>>0;return num}function mv1(i,v){i=i-v;return i>-1?i:10+i}function nshift(s,v){var num=""+s;var r=[];for(var i=0;i<num.length;i++){r.push(mv1(Number(num.charAt(i)),v))}return r.join("")}function s6(s){s=""+s;var code=[];for(var i=0;i<s.length;i++){var t=""+s.charCodeAt(i);var l=t.length;code.push(l);code.push(t)}return code.join("")}function getUserCode(){var d=Math.round((new Date).getTime()/1e3);var n=d%10;var u=user;if(!u){u={ip:"127.0.0.1",id:0}}if(!u.ip)u.ip="127.0.0.1";return d+"."+nshift(u.id,n)+"."+ip2int(u.ip)+"."+s6(u.name)}var info={};function cp(s,d,p){if(!!p)for(var i=0;i<p.length;i++){try{if(!!s[p[i]])d[p[i]]=s[p[i]]}catch(e){}}}var t_=function(duration){var e="0";if(duration){var exp=((new Date).getTime()-duration+1e4)/100;e=""+Math.round(exp)}else{var exp=((new Date).getTime()+1e4)/100;e=""+Math.round(exp)}return e};var pros=["random","method","hash","ip","duration","abc","cc","dd"];var j=function(j){return j.join("|")};var substr=function(s,len){return s.substring(0,len)};var vcc=function(a,b,c){var p=pros;var e=t_;var _=function(a,b){return a[b]};return function(d){var $_=[e(c.duration)];var h=a(j([d,$_[0],_(c,p[0]),c.cc]));$_.push(substr(h,50));return token($_)}}($h,gcccode,info);var updater=function(dest,pros){var d=dest;var p=pros;return function(data){cp(data,d,p)}};var flush=updater(info,pros);var init=function(){http().get(uasServer+"?e=version").then(function(a){capHash=a.hash;a.duration=(new Date).getTime()-a.time;a.cc=gcccode;flush(a)})};function uc(uc_key){var UC_Sbox_Inv=null;var UC_ShiftRowTab_Inv=null;var UC_xtime=null;var UC_ShiftRowTab=new Array(0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11);function UC_Init(){UC_Sbox_Inv=new Array(256);for(var i=0;i<256;i++)UC_Sbox_Inv[UC_Sbox[i]]=i;UC_ShiftRowTab_Inv=new Array(16);for(var i=0;i<16;i++)UC_ShiftRowTab_Inv[UC_ShiftRowTab[i]]=i;UC_xtime=new Array(256);for(var i=0;i<128;i++){UC_xtime[i]=i<<1;UC_xtime[128+i]=i<<1^27}}function UC_Done(){}function UC_ExpandKey(key){var kl=key.length,ks,Rcon=1;switch(kl){case 16:ks=16*(10+1);break;case 24:ks=16*(12+1);break;case 32:ks=16*(14+1);break;default:alert("UC_ExpandKey: Only key lengths of 16, 24 or 32 bytes allowed!")}for(var i=kl;i<ks;i+=4){var temp=key.slice(i-4,i);if(i%kl==0){temp=new Array(UC_Sbox[temp[1]]^Rcon,UC_Sbox[temp[2]],UC_Sbox[temp[3]],UC_Sbox[temp[0]]);if((Rcon<<=1)>=256)Rcon^=283}else if(kl>24&&i%kl==16)temp=new Array(UC_Sbox[temp[0]],UC_Sbox[temp[1]],UC_Sbox[temp[2]],UC_Sbox[temp[3]]);for(var j=0;j<4;j++)key[i+j]=key[i+j-kl]^temp[j]}}function UC_Encrypt(block,key){var l=key.length;UC_AddRoundKey(block,key.slice(0,16));for(var i=16;i<l-16;i+=16){UC_SubBytes(block,UC_Sbox);UC_ShiftRows(block,UC_ShiftRowTab);UC_MixColumns(block);UC_AddRoundKey(block,key.slice(i,i+16))}UC_SubBytes(block,UC_Sbox);UC_ShiftRows(block,UC_ShiftRowTab);UC_AddRoundKey(block,key.slice(i,l))}function UC_Decrypt(block,key){var l=key.length;UC_AddRoundKey(block,key.slice(l-16,l));UC_ShiftRows(block,UC_ShiftRowTab_Inv);UC_SubBytes(block,UC_Sbox_Inv);for(var i=l-32;i>=16;i-=16){UC_AddRoundKey(block,key.slice(i,i+16));UC_MixColumns_Inv(block);UC_ShiftRows(block,UC_ShiftRowTab_Inv);UC_SubBytes(block,UC_Sbox_Inv)}UC_AddRoundKey(block,key.slice(0,16))}var UC_Sbox=new Array(99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22);function UC_SubBytes(state,sbox){for(var i=0;i<16;i++)state[i]=sbox[state[i]]}function UC_AddRoundKey(state,rkey){for(var i=0;i<16;i++)state[i]^=rkey[i]}function UC_ShiftRows(state,shifttab){var h=(new Array).concat(state);for(var i=0;i<16;i++)state[i]=h[shifttab[i]]}function UC_MixColumns(state){for(var i=0;i<16;i+=4){var s0=state[i+0],s1=state[i+1];var s2=state[i+2],s3=state[i+3];var h=s0^s1^s2^s3;state[i+0]^=h^UC_xtime[s0^s1];state[i+1]^=h^UC_xtime[s1^s2];state[i+2]^=h^UC_xtime[s2^s3];state[i+3]^=h^UC_xtime[s3^s0]}}function UC_MixColumns_Inv(state){for(var i=0;i<16;i+=4){var s0=state[i+0],s1=state[i+1];var s2=state[i+2],s3=state[i+3];var h=s0^s1^s2^s3;var xh=UC_xtime[h];var h1=UC_xtime[UC_xtime[xh^s0^s2]]^h;var h2=UC_xtime[UC_xtime[xh^s1^s3]]^h;state[i+0]^=h1^UC_xtime[s0^s1];state[i+1]^=h2^UC_xtime[s1^s2];state[i+2]^=h1^UC_xtime[s2^s3];state[i+3]^=h2^UC_xtime[s3^s0]}}function padding(data){if(data&&data.length){var len=data.length;if(len%16>0){for(var i=0;i<16-len%16;i++){data.push(0)}}}return data}function escPadding(data){if(data&&data.length){var len=data.length;var di=-1;for(var i=len-1;i>=0;i--){if(data[i]!=0){di=i;break}}if(di>0){return data.slice(0,di+1)}}return data}function Encrypt(data){data=padding(data);var rest=new Array;for(var i=0;i<data.length;i+=16){var block=data.slice(i,i+16);UC_Encrypt(block,uc_key);rest=rest.concat(block)}return rest}function Decrypt(data){var rest=new Array;for(var i=0;i<data.length;i+=16){var block=data.slice(i,i+16);UC_Decrypt(block,uc_key);rest=rest.concat(block)}return escPadding(rest)}UC_Init();if(typeof uc_key==="string"){uc_key=hexToBytes(uc_key)}uc_key=fiexdSlice(uc_key,16);UC_ExpandKey(uc_key);function toEncryptHex(str){var b=stringToByte(str);var data=Encrypt(b);return bytesToHex(data)}function toDecryptStr(hex){var b=hexToBytes(hex);var data=Decrypt(b);return byteToString(escPadding(data))}function fiexdSlice(b,len){if(!isArray(b))return null;var l=b.length;if(l==len){return b}if(l<len){for(var i=0;i<len-l;i++){b.push(0)}return b}return b.slice(0,len)}function isArray(ar){if(!ar)return false;return!!ar.push&&!!ar.join}return{encrypt:Encrypt,decrypt:Decrypt,close:function(){UC_Done()},toHex:toEncryptHex,toStr:toDecryptStr}}function stringToByte(str){var bytes=new Array;var len,c;len=str.length;for(var i=0;i<len;i++){c=str.charCodeAt(i);if(c>=65536&&c<=1114111){bytes.push(c>>18&7|240);bytes.push(c>>12&63|128);bytes.push(c>>6&63|128);bytes.push(c&63|128)}else if(c>=2048&&c<=65535){bytes.push(c>>12&15|224);bytes.push(c>>6&63|128);bytes.push(c&63|128)}else if(c>=128&&c<=2047){bytes.push(c>>6&31|192);bytes.push(c&63|128)}else{bytes.push(c&255)}}return bytes}function byteToString(arr){if(typeof arr==="string"){return arr}var str="",_arr=arr;for(var i=0;i<_arr.length;i++){var one=_arr[i].toString(2),v=one.match(/^1+?(?=0)/);if(v&&one.length==8){var bytesLength=v[0].length;var store=_arr[i].toString(2).slice(7-bytesLength);for(var st=1;st<bytesLength;st++){store+=_arr[st+i].toString(2).slice(2)}str+=String.fromCharCode(parseInt(store,2));i+=bytesLength-1}else{str+=String.fromCharCode(_arr[i])}}return str}function hexToBytes(hex){hex=hex.toString();for(var bytes=[],c=0;c<hex.length;c+=2)bytes.push(parseInt(hex.substr(c,2),16));return bytes}function bytesToHex(bytes){for(var hex=[],i=0;i<bytes.length;i++){var current=bytes[i]<0?bytes[i]+256:bytes[i];hex.push((current>>>4).toString(16));hex.push((current&15).toString(16))}return hex.join("")}function escString(str){if(typeof str==="string"){return str.replace(new RegExp("\0","gm"),"")}return str}function s8(v,fun){if(v!=null&&typeof v==="string"&&v.length>1&&v.charAt(0)=="#"){return escString(fun(v.substr(1)))}else{return v}}function s7(key){var $=uc(stringToByte(key));return function(v){return fixedPros(v,function(k){return s8(k,$.toStr)})}}var $ac=null;var $ak=null;function s9(w,f){if(!$ac){$ac=w;$ak=S4()+"-"+S4();return $ak}else{var k=f($ak);var data=k($ac+":"+w);$ac=null;$ak=null;return data}}function s10(w){return s9(w,function(k){return uc($h(k)).toHex},function(d){})}function deepClone(origin,target){var target=target||{},toStr=Object.prototype.toString,arrStr="[object Array]";for(var prop in origin){if(origin.hasOwnProperty(prop)){if(origin[prop]!=="null"&&typeof origin[prop]=="object"){target[prop]=toStr.call(origin[prop])==arrStr?[]:{};deepClone(origin[prop],target[prop])}else{target[prop]=origin[prop]}}}return target}function fixedPros(origin,fixed){if(typeof origin==="string"){return fixed(origin)}for(var prop in origin){if(origin.hasOwnProperty(prop)){if(origin[prop]!=="null"&&typeof origin[prop]==="object"){if(isArray(origin[prop])){for(var i=0;i<origin[prop].length;i++){origin[prop][i]=fixedPros(origin[prop][i],fixed)}}else{origin[prop]=fixedPros(origin[prop],fixed)}}else if(typeof origin[prop]==="string"){origin[prop]=fixed(origin[prop])}}}return origin}function loginByToken(tk){var token=tk;return{then:function(callback){checkst(callback,token)}}}function refreshSms(token){return http().get(uasServer+"?e=2fa-login&type=refresh&token="+token+"&guid="+gcccode+"&vcc="+vcc(token))}function clientToken(){var uid=gcccode;if(!uasDomain)uasDomain="default";var time=""+((new Date).getTime()-duration);var h=$1().digest(gcccode+hash+uasDomain+user.id+time);return token([h,uasDomain,user.id,time])}function loginByClientToken(tk){tk="CTGCC"+tk;return loginByToken(tk)}var client={ajax:ajax,uuid:guid,sha256:Sha256,login:login,server:server,getUser:getUser,checkLogin:checkLogin,getToken:getToken,logout:logout,changePassword:changePassword,useCaptcha:useCaptcha,useChinese:useChinese,getImage:getImage,test:test,loginByToken:loginByToken,version:version,testuas:testuas,domain:domain,sso:jumpsso,tfa:tfa,refreshSms:refreshSms,clientToken:clientToken,loginByClientToken:loginByClientToken,getUserCode:getUserCode,getServiceTicket:getServiceTicket,checkFake:function(ff){fake=ff},sendsms:sendsms,tokenfecther:function(func){getThirdToken=func}};try{if(iswx){wx.uas=client}if(window){window.uas=client}}catch(e){}return client});